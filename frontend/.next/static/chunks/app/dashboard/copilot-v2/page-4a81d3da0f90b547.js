(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[259],{1044:function(e,t,n){Promise.resolve().then(n.bind(n,6989))},6989:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return CopilotV2}});var o=n(7437),r=n(2265),a=n(732);function CopilotHeader(e){let{model:t,onModelChange:n}=e;return(0,o.jsxs)("div",{className:"flex items-center justify-between border-b p-2",children:[(0,o.jsx)("h2",{className:"font-semibold",children:"Copilot V2"}),(0,o.jsxs)("select",{className:"border rounded px-2 py-1 text-sm",value:t,onChange:e=>n(e.target.value),children:[(0,o.jsx)("option",{value:"claude",children:"Claude"}),(0,o.jsx)("option",{value:"chatgpt",children:"ChatGPT"}),(0,o.jsx)("option",{value:"gemini",children:"Gemini"}),(0,o.jsx)("option",{value:"disabled",children:"Disabled"})]})]})}function CopilotResponse(e){let{role:t,text:n}=e,r="user"===t;return(0,o.jsx)("div",{className:"w-full flex ".concat(r?"justify-end":"justify-start"),children:(0,o.jsx)("div",{className:"whitespace-pre-wrap max-w-[80%] px-3 py-2 rounded text-sm ".concat(r?"bg-primary text-primary-foreground":"bg-muted"),children:(0,o.jsx)("pre",{className:"whitespace-pre-wrap font-sans text-sm",children:n})})})}var c=n(6702),s=n(2662);function CopilotV2(){let[e,t]=(0,r.useState)([]),[n,i]=(0,r.useState)(""),[u,l]=(0,r.useState)("claude"),[d,h]=(0,r.useState)(!1),[p,f]=(0,r.useState)(""),[m,y]=(0,r.useState)(!1),x=(0,r.useRef)(null);async function send(){if(n.trim()&&"disabled"!==u){i(""),t(e=>[...e,{role:"user",content:n}]),h(!0);try{var e,o;let r=await (0,c.JB)(n),a=(null===(o=r.results)||void 0===o?void 0:null===(e=o[0])||void 0===e?void 0:e.content_chunk)||"";f(a);let i="Context:\n".concat(a,"\n\nPrompt:\n").concat(n),l="claude"===u?s.g:s.j,d=await l(i),h=d.result||d.response||d.completion||"";t(e=>[...e,{role:"ai",content:""}]);let p="";for(let e of h)p+=e,t(e=>{let t=[...e];return t[t.length-1]={role:"ai",content:p},t}),await new Promise(e=>setTimeout(e,20));(0,c.Ei)({project_id:"chat",title:n.slice(0,40),content:"".concat(n,"\n").concat(h),author_id:"user"}).catch(()=>{})}catch(e){t(e=>[...e,{role:"ai",content:"Error"}])}finally{h(!1),setTimeout(()=>{var e;return null===(e=x.current)||void 0===e?void 0:e.scrollIntoView({behavior:"smooth"})},50)}}}return(0,o.jsxs)("div",{className:"flex flex-col h-full",children:[(0,o.jsx)(CopilotHeader,{model:u,onModelChange:l}),p&&(0,o.jsx)("button",{onClick:()=>y(!m),className:"self-end text-xs underline mb-1",children:m?"Hide memory":"Show memory"}),m&&p&&(0,o.jsx)("div",{className:"border rounded p-2 text-xs whitespace-pre-wrap mb-2 bg-muted",children:p}),(0,o.jsxs)("div",{className:"flex-1 overflow-auto p-2 space-y-2",children:[0===e.length&&!d&&(0,o.jsx)("p",{className:"text-sm opacity-60",children:"Ask me anything to begin..."}),e.map((e,t)=>(0,o.jsx)(CopilotResponse,{role:e.role,text:e.content},t)),d&&(0,o.jsx)("p",{className:"text-sm opacity-60",children:"Loading..."}),(0,o.jsx)("div",{ref:x})]}),(0,o.jsxs)(a.E.form,{initial:{y:50,opacity:0},animate:{y:0,opacity:1},onSubmit:e=>{e.preventDefault(),send()},className:"p-2 border-t flex gap-2",children:[(0,o.jsx)("input",{value:n,onChange:e=>i(e.target.value),placeholder:"Ask the copilot...",className:"flex-1 border px-3 py-2 rounded"}),(0,o.jsx)("button",{type:"submit",disabled:d,className:"bg-primary text-primary-foreground px-4 py-2 rounded",children:"Send"})]})]})}},2662:function(e,t,n){"use strict";async function promptClaude(e){return fetch("/api/claude",{method:"POST",body:JSON.stringify({prompt:e})}).then(e=>e.json())}async function promptChatGPT(e){return fetch("/api/chatgpt",{method:"POST",body:JSON.stringify({prompt:e})}).then(e=>e.json())}n.d(t,{g:function(){return promptClaude},j:function(){return promptChatGPT}})},6702:function(e,t,n){"use strict";n.d(t,{Dh:function(){return fetchDocuments},Ei:function(){return writeMemory},IW:function(){return fetchOpsMetrics},JB:function(){return postMemoryQuery},L3:function(){return fetchRecentTasks},_s:function(){return syncClaudeLogs},gU:function(){return updateDocument},k4:function(){return fetchProductDocs},z:function(){return fetchRecentPosts}});var o=n(2549);function authHeader(){{let e=localStorage.getItem("token");if(e)return{Authorization:"Bearer ".concat(e)}}return{}}async function postMemoryQuery(e){let t=await fetch("".concat(o.S,"/memory/query"),{method:"POST",headers:{"Content-Type":"application/json",...authHeader()},body:JSON.stringify({query:e})});return t.json()}async function syncClaudeLogs(){return fetch("".concat(o.S,"/sync-claude-logs"),{method:"POST",headers:authHeader()}).then(e=>e.json())}async function fetchDocuments(){return fetch("".concat(o.S,"/documents"),{headers:authHeader()}).then(e=>e.json())}async function updateDocument(e,t){return fetch("".concat(o.S,"/memory/update"),{method:"POST",headers:{"Content-Type":"application/json",...authHeader()},body:JSON.stringify({document_id:e,content:t})}).then(e=>e.json())}async function writeMemory(e){return fetch("".concat(o.S,"/memory/write"),{method:"POST",headers:{"Content-Type":"application/json",...authHeader()},body:JSON.stringify(e)}).then(e=>e.json())}async function fetchProductDocs(){return fetch("".concat(o.S,"/memory/query?tags=product&limit=50"),{headers:authHeader()}).then(e=>e.json())}async function fetchOpsMetrics(){return fetch("".concat(o.S,"/dashboard/ops"),{headers:authHeader()}).then(e=>e.json())}async function fetchRecentPosts(){return fetch("".concat(o.S,"/memory/search?limit=5"),{headers:authHeader()}).then(e=>e.json())}async function fetchRecentTasks(){return fetch("".concat(o.S,"/dashboard/tasks"),{headers:authHeader()}).then(e=>e.json())}},2549:function(e,t,n){"use strict";n.d(t,{S:function(){return o}});let o="https://brainops-operator.onrender.com"}},function(e){e.O(0,[600,971,472,744],function(){return e(e.s=1044)}),_N_E=e.O()}]);