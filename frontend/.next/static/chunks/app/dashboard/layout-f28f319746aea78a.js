(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[663],{2177:function(e,t,r){Promise.resolve().then(r.bind(r,511)),Promise.resolve().then(r.t.bind(r,8326,23))},511:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return AssistantChatWidget}});var s=r(7437),n=r(2265);async function readSSE(e,t){var r;let s=null===(r=e.body)||void 0===r?void 0:r.getReader();if(!s)return;let n=new TextDecoder,a="";for(;;){let{value:e,done:r}=await s.read();if(r)break;if(e){a+=n.decode(e,{stream:!0});let r=a.split("\n\n");for(let e of(a=r.pop()||"",r)){let r=e.trim();if(r.startsWith("data:")){let e=r.slice(5).trim();if("[DONE]"===e)return;t(e)}}}}}function AssistantChatWidget(){let[e,t]=(0,n.useState)(!1),[r,a]=(0,n.useState)([]),[o,i]=(0,n.useState)(""),[l,d]=(0,n.useState)(!1);async function send(){if(!o.trim())return;i("");let e=0;a(t=>(e=t.length+1,[...t,{role:"user",text:o},{role:"assistant",text:""}])),d(!0);try{var t;let r=await fetch("/api/assistant/chat",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({message:o,stream:!0})});if(null===(t=r.headers.get("content-type"))||void 0===t?void 0:t.includes("text/event-stream"))await readSSE(r,t=>{a(r=>{let s=[...r];return s[e].text+=t,s})});else{let t=await r.json(),s=t.response||t.result||t.completion||"";a(t=>{let r=[...t];return r[e].text=s,r})}}catch(t){a(t=>{let r=[...t];return r[e].text="Error",r})}finally{d(!1)}}return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("button",{onClick:()=>t(e=>!e),className:"fixed bottom-4 right-4 bg-primary text-primary-foreground px-4 py-2 rounded-full",children:e?"Close":"Chat"}),e&&(0,s.jsxs)("div",{className:"fixed bottom-16 right-4 bg-background border rounded shadow-lg w-80 max-h-96 flex flex-col",children:[(0,s.jsxs)("div",{className:"flex-1 p-2 overflow-auto space-y-2",children:[r.map((e,t)=>(0,s.jsx)("div",{className:"user"===e.role?"text-right":"text-left",children:(0,s.jsx)("span",{className:"text-sm whitespace-pre-wrap",children:e.text})},t)),l&&(0,s.jsx)("p",{className:"text-sm opacity-50",children:"..."})]}),(0,s.jsxs)("form",{onSubmit:e=>{e.preventDefault(),send()},className:"p-2 border-t flex gap-2",children:[(0,s.jsx)("input",{className:"flex-1 border px-2 py-1 rounded",value:o,onChange:e=>i(e.target.value),placeholder:"Message"}),(0,s.jsx)("button",{type:"submit",disabled:l,className:"bg-primary text-primary-foreground px-3 py-1 rounded",children:"Send"})]})]})]})}},622:function(e,t,r){"use strict";/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var s=r(2265),n=Symbol.for("react.element"),a=Symbol.for("react.fragment"),o=Object.prototype.hasOwnProperty,i=s.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,l={key:!0,ref:!0,__self:!0,__source:!0};function q(e,t,r){var s,a={},d=null,u=null;for(s in void 0!==r&&(d=""+r),void 0!==t.key&&(d=""+t.key),void 0!==t.ref&&(u=t.ref),t)o.call(t,s)&&!l.hasOwnProperty(s)&&(a[s]=t[s]);if(e&&e.defaultProps)for(s in t=e.defaultProps)void 0===a[s]&&(a[s]=t[s]);return{$$typeof:n,type:e,key:d,ref:u,props:a,_owner:i.current}}t.Fragment=a,t.jsx=q,t.jsxs=q},7437:function(e,t,r){"use strict";e.exports=r(622)}},function(e){e.O(0,[326,971,472,744],function(){return e(e.s=2177)}),_N_E=e.O()}]);